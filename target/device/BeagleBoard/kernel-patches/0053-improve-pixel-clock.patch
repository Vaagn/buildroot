diff --git a/d4efeeaf940b0e3c56d7fe45642add5317a0e251:drivers/video/omap/dispc.c b/057f80c38e2221cfac9ceb7b9db752352b28ceda:drivers/video/omap/dispc.c
index 53a97bcb9eff31bf6b187adb73103998176f8386..7e4c703c0fe862a2c704cef0a4d69f6cf377bfb5 100644
--- a/drivers/video/omap/dispc.c
+++ b/drivers/video/omap/dispc.c
@@ -177,6 +177,7 @@ static struct {
 
 	struct clk	*dss_ick, *dss1_fck;
 	struct clk	*dss_54m_fck;
+	struct clk	*dpll4_m4_ck;
 
 	enum omapfb_update_mode	update_mode;
 	struct omapfb_device	*fbdev;
@@ -737,19 +738,34 @@ static void setup_color_conv_coef(void)
 	MOD_REG_FLD(at2_reg, (1 << 11), ct->full_range);
 }
 
+#define MAX_FCK 173000000
+
 static void calc_ck_div(int is_tft, int pck, int *lck_div, int *pck_div)
 {
+	unsigned long prate = clk_get_rate(clk_get_parent(dispc.dpll4_m4_ck));
+	unsigned long pcd_min = is_tft? 2: 3;
+	unsigned long fck_div;
 	unsigned long fck, lck;
 
-	*lck_div = 1;
 	pck = max(1, pck);
+
+	if (pck * pcd_min > MAX_FCK) {
+		dev_warn(dispc.fbdev->dev, "pixclock %d kHz too high.\n",
+			 pck / 1000);
+		pck = MAX_FCK / pcd_min;
+	}
+
+	fck = pck * 2;
+	fck_div = (prate + pck) / fck;
+	if (fck_div > 16)
+		fck_div /= (fck_div + 15) / 16;
+	if (fck_div < 1)
+		fck_div = 1;
+	clk_set_rate(dispc.dpll4_m4_ck, prate / fck_div);
 	fck = clk_get_rate(dispc.dss1_fck);
-	lck = fck;
-	*pck_div = (lck + pck - 1) / pck;
-	if (is_tft)
-		*pck_div = max(2, *pck_div);
-	else
-		*pck_div = max(3, *pck_div);
+
+	*lck_div = 1;
+	*pck_div = (fck + pck - 1) / pck;
 	if (*pck_div > 255) {
 		*pck_div = 255;
 		lck = pck * *pck_div;
@@ -910,11 +926,21 @@ static int get_dss_clocks(void)
 		return PTR_ERR(dispc.dss_54m_fck);
 	}
 
+	if (IS_ERR((dispc.dpll4_m4_ck =
+				clk_get(dispc.fbdev->dev, "dpll4_m4_ck")))) {
+		dev_err(dispc.fbdev->dev, "can't get dpll4_m4_ck");
+		clk_put(dispc.dss_ick);
+		clk_put(dispc.dss1_fck);
+		clk_put(dispc.dss_54m_fck);
+		return PTR_ERR(dispc.dss_54m_fck);
+	}
+
 	return 0;
 }
 
 static void put_dss_clocks(void)
 {
+	clk_put(dispc.dpll4_m4_ck);
 	clk_put(dispc.dss_54m_fck);
 	clk_put(dispc.dss1_fck);
 	clk_put(dispc.dss_ick);
